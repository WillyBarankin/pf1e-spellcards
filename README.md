# Карточки заклинаний Pathfinder

Генератор HTML-карточек заклинаний Pathfinder на русском языке. Данные берутся из CSV; вывод — готовые страницы с карточками для печати или просмотра.

**Это форк** [kikht/pfd-spellcards](https://github.com/kikht/pfd-spellcards). Сделал для себя: возможность добавлять новые заклинания (в т.ч. из Ultimate Magic) и более эффективное использование бумаги — печать на A4 альбомом, подгонка длинных описаний под карточку и раскладка без пустых мест на листе. Отличия от оригинала перечислены в разделе «Отличия от оригинальной версии» ниже.

## Требования

- Go 1.24+

## Сборка карточек

Из корня проекта:

```bash
go run . -class <класс> -level <уровни> > вывод.html
```

**Флаги:**

- `-class` — класс персонажа (по умолчанию `wiz`). Варианты: `wiz`, `sor`, `cleric`, `druid`, `ranger`, `bard`, `paladin`, `alchemist`, `summoner`, `witch`, `inquisitor`, `oracle`, `antipaladin`, `magus`, `adept`.
- `-level` — уровни заклинаний через запятую, например `0`, `1,2,3` или `1-3`.

**Примеры:**

```bash
go run . -class bard -level 3 > bard_lvl3.html
go run . -class wiz -level 0,1,2 > wiz_cantrips_lvl1-2.html
```

Для отображения карточек откройте полученный HTML в браузере; нужны файлы `cards.css`, `cards.js` и папки `img/`, `tiles/` в том же каталоге (или рядом с HTML).

## Добавление новых заклинаний

1. **Добавить строку в `spells.csv`** — скопировать любую существующую строку и подставить данные нового заклинания. Обязательно заполнить: `name_en`, `name_ru1`, `name_ru`, `school`, `spell_level`, `casting_time`, `components`, `components_ru`, `range`, `duration`, `saving_throw`, `spell_resistence`, `description`, `description_formated`, `description_formated_ru` (русское описание в HTML, абзацы в `<p>...</p>`), `source`, уровни по классам (`sor`, `wiz`, `bard` и т.д.), `short_description`, `short_description_ru`. В CSV кавычки внутри поля удваиваются (`""`).
2. **Источник заклинания:** в колонке `source` должно быть ровно `PFRPG Core` или `Ultimate Magic` — иначе строка не попадёт в выборку. Если заклинание из другой книги: в `cards.go` добавить константу (например `allowedSourceX = "Название книги"`) и в условии фильтра (строка ~541) добавить проверку `src != allowedSourceX` в цепочку с остальными допустимыми источниками.

После правок пересобрать карточки: `go run . -class <класс> -level <уровни> > вывод.html`.

### Как добавить все заклинания из Ultimate Magic

- **Ручное добавление:** добавлять заклинания по одному в `spells.csv` (копировать строку, например Chord of Shards, менять поля; в `source` указывать `Ultimate Magic`). Источник уже разрешён в `cards.go`.
- **Массовый импорт:** готового парсера под Ultimate Magic в проекте нет. Если есть список/HTML/CSV (например, с [Archives of Nethys](https://legacy.aonprd.com/ultimatemagic/ultimateMagicSpellIndex.html) или [d20 SRD](https://pathfinder.d20srd.org/ultimateMagic/ultimateMagicSpellIndex.html)) — положить данные в `translations/`, написать или адаптировать парсер по аналогии с `parse-site.go` / `parse-a.go`, вывести CSV с колонками как в `spells.csv` (обязательно `source=Ultimate Magic`) и влить строки в основной `spells.csv`. Русские названия и описания при массовом импорте обычно подставляют позже или из отдельного источника переводов.

**Почему не работает вариант «как с Core»?** Для Core в репозитории уже есть готовые данные: полная база по Core в `spells.csv` (изначально из pathfindercommunity.net и т.п.) и русскоязычные источники — вики-экспорт `spells-a.txt` и выкачанные HTML страницы в `site-spells/` (Справочник PFRPG на Google Sites, только Core). Парсеры `parse-a.go` и `parse-site.go` извлекают из них только русские названия и описания и подставляют в существующие строки CSV. Для Ultimate Magic нет ни полной базы строк в CSV (только одно заклинание для примера), ни такого же русскоязычного справочника по UM в проекте (на pfrpgrd были только заклинания Core), поэтому тот же конвейер применить нельзя — нужен либо ручной ввод, либо новый парсер под английский источник (AoN/d20) и при необходимости отдельный источник переводов.

## Структура проекта

| Путь | Назначение |
|------|------------|
| `cards.go` | Генератор карточек, шаблон и перевод терминов |
| `cards.template` | HTML-шаблон карточки |
| `cards.css`, `cards.js` | Стили и скрипты для карточек |
| `spells.csv` | База заклинаний (поля на русском и английском) |
| `img/` | Иконки школ, компонентов, дескрипторов |
| `tiles/` | Изображения областей (конус, радиус и т.п.) |
| `translations/` | Утилиты для парсинга и сборки переводов |

В `translations/` лежат отдельные Go-программы с тегами сборки (например, `printbook`) для обработки текстов с сайтов и книг и обновления переводов.

## Отличия от оригинальной версии

- **Источники:** в список допустимых источников добавлен *Ultimate Magic*; в `spells.csv` для примера добавлено заклинание «Хор осколков» (Chord of Shards).
- **Таблицы в описаниях:** текстовые таблицы в русских описаниях переведены в HTML (`<table class="commonTable">`); у таблиц убраны inline-стили (оформление задаётся в `cards.css`). Единые правила: ширина 94%, фиксированная раскладка, перенос слов.
- **Печать:** в `@page` заданы A4 landscape и уменьшенные поля по умолчанию (5mm).
- **Подгонка описания под карточку:** при переполнении по высоте у карточек с 2–4 колонками уменьшается шрифт только в блоке описания (класс `tight-description`, 2.1mm). Класс оставляется только если после уменьшения реально уменьшилось число колонок; затем выполняется повторная расстановка пар «3 колонки + 1 колонка», чтобы при печати не оставалось пустых мест в рядах.

## Источники

- **База заклинаний:** http://www.pathfindercommunity.net/home/databases/spells  
- **Оформление карточек:** http://www.rpgbooster.com/downloads/  
- **Иконки:** http://game-icons.net/  
- **Переводы:**  
  - https://vk.com/pathfinderrus  
  - http://trans.rpground.ru/index.php?title=Pathfinder_Core_Rulebook  
  - https://sites.google.com/site/pfrpgrd/magic/all-spells  
